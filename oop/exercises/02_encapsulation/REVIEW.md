# レッスン02: カプセル化 - レビュー

## 学習日
2025-11-29

## 学習した概念

- **カプセル化（Encapsulation）**: 内部状態を守るルールを、オブジェクト自身が持つこと
- **ルールの責任の所在**: 「残高がマイナスにならない」というルールは呼び出し側ではなく、口座自身が守るべき
- **カプセル化のメリット**:
  - 修正箇所が1箇所で済む（ルール変更時）
  - チェック漏れがなくなる
  - ルールがクラスに集約される
- **attr_reader / attr_writer / attr_accessor の違い**: それぞれが何を生成するか

## 質疑応答のポイント

### Q: 「残高がマイナスにならない」ルールは誰が守るべき？

**回答**: 口座自身が守るべき。`withdraw`の中でチェックすることで、ルールが変わっても修正箇所が1箇所で済む。

→ 正しく理解。途中で「呼び出し側」と言い間違えたが、考え方自体は合っていた。

### Q: `attr_writer :deposit, :withdraw` を書いた意図は？

**当初の回答**: Rubyの標準機能だから再実装すべきでないと判断した。

**問題点**: `attr_writer :deposit` は `deposit=(val)` を生成する。しかし今回使っているのは `deposit(amount)` という別のメソッド。この行は完全に不要だった。

→ `attr_writer`の機能は理解していたが、今回のコードで必要かどうかを確認していなかった。

## 良かった点

1. **カプセル化の本質を理解** - 「ルールは口座自身が守る」という設計判断ができた
2. **`withdraw`のロジック** - 残高チェック → false/true の実装が正しい
3. **01の学びが定着** - `attr_reader :balance` を使い、外部からの直接変更を防いでいる
4. **素直に修正できた** - 不要な行を指摘されたらすぐに理解して修正した

## 次に深掘りすべきこと

- **コードを書く前の確認**: 「このコードは何をするか」「本当に必要か」を考える習慣
- **メソッド名の違いに注意**: `deposit` と `deposit=` は別物。Rubyの命名規則を意識する
- **不変条件（Invariant）**: 「常に満たされるべき条件」という概念。今回は「残高 >= 0」がそれにあたる

## 総合評価

カプセル化の本質 - 「ルールをオブジェクト自身が守る」ことの意味とメリット - を正しく理解できた。

`attr_writer`の件は、知識はあったが「今回必要か」を確認しなかったケース。コードを書く前に「このコードは何をするか」「このコードは本当に必要か」を確認する癖をつけると、無駄なコードが減る。

全体としては良い進捗。次の「責務の分離」に進む準備ができている。
