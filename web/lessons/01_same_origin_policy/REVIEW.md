# レッスン01: Same-Origin Policy と CORS - レビュー

## 学習日
2025-12-01

## 学習した概念
- オリジンの定義（スキーム、ホスト、ポートの3要素）
- Same-Origin Policy の役割と制限範囲
- 「リクエスト送信は止めない、レスポンス読み取りを止める」という設計
- CORS は制限を「緩和」する仕組み（強化ではない）
- プリフライトリクエストの目的
- CSRFとSame-Origin Policyの関係

## 質疑応答のポイント

### オリジン判定
- `https://example.com:443` と `https://example.com` は同一オリジン
- HTTPSのデフォルトポートは443のため、省略時と明示時で同じになる
- この点は最初誤答 → 補足説明で理解

### 攻撃シナリオの理解
- 最初の回答：「攻撃者がリクエストを送り、レスポンスを読み取る」→ 概念は正しい
- 深掘り：「なぜログインしていない攻撃者が、ログイン済み情報を取得できるか」
- 最初の回答：「Cookieを盗む」→ やや不正確
- 補足：**ブラウザがCookieを自動送信する**仕組みが本質。攻撃者はCookieの中身を知らなくても、ブラウザが勝手に付けて送る

### CSRFとの関係（重要な議論）
- 問い：「Same-Origin PolicyだけでCSRFは防げるか？」
- 最初の回答：「防げる。読み取れないから」→ 誤り
- 正解：**防げない**。CSRFは「送信」が目的で「読み取り」が不要な攻撃
- `<form>`による別オリジンへのPOSTはSame-Origin Policyの対象外

### CSRFトークンが機能する理由
- 問い：「なぜ攻撃者はCSRFトークンを入手できないか」
- 回答：「リクエストはできても読み取れないから」→ 正しい
- Same-Origin Policyがトークン窃取を防ぎ、トークンが送信攻撃を防ぐ、という連携

## 良かった点
- 概念の理解が早い
- 「CORSは緩和する仕組み」という本質を正しく捉えた
- 質問に対して自分なりの仮説を立てて回答していた
- 間違いを指摘されたときに素直に理解を修正できた

## 次に深掘りすべきこと
- CSRFトークンの具体的な実装パターン（Railsでの扱い）
- SameSite Cookie属性によるCSRF対策
- CORSの credentials モードと `Access-Control-Allow-Credentials` の関係

## 総合評価
Same-Origin Policy の本質（「読み取り」の制限）と、その限界（「送信」は止められない）を理解できた。特にCSRFとの関係を議論したことで、セキュリティ機構が単体ではなく組み合わせで機能することを実感できたと思う。次のレッスン（認証と認可）への土台ができた。
